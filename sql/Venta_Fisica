SELECT * FROM V_HORARIOS_TIENDAS;
SELECT * FROM V_CLIENTES_LEGO;
SELECT * FROM V_PRODUCTOS_POR_TIENDA;

SELECT FN_CALCULAR_STOCK_NETO(2, 11203) AS Neto_Stock FROM DUAL;

DECLARE
    p_id_tienda      TIENDAS.ID_TIENDA%TYPE      := 2; 
    p_id_cliente     CLIENTES_LEGO.ID_CLIENTE%TYPE := 1;
    p_ids_juguete    T_NUMBER_ARRAY := T_NUMBER_ARRAY(11203, 11203, 11203);                  

BEGIN
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '--- EJECUCIÓN: Registrando Venta ---');
    DBMS_OUTPUT.PUT_LINE(' -> Comprando ' || p_ids_juguete.COUNT || ' juguete(s) para el cliente ' || p_id_cliente || ' en la tienda ' || p_id_tienda || '.');

    REGISTRAR_VENTA_LEGO_FISICA(
        p_id_cliente  => p_id_cliente,
        p_id_tienda   => p_id_tienda,
        p_ids_juguete => p_ids_juguete
    );

    DBMS_OUTPUT.PUT_LINE(' -> Venta registrada exitosamente.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('ERROR: La prueba falló inesperadamente.');
        DBMS_OUTPUT.PUT_LINE('SQLCODE: ' || SQLCODE || ', SQLERRM: ' || SQLERRM);
        ROLLBACK;
END;
/

SELECT V_FACTURA_FISICA_DETALLE_REF.* FROM V_FACTURA_FISICA_DETALLE_REF
WHERE "Numero de Factura" = 2;

SELECT * FROM V_DETALLE_FACTURA_FISICA_REF;
